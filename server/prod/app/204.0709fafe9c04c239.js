"use strict";(self.webpackChunkkinect_theia_console=self.webpackChunkkinect_theia_console||[]).push([[204],{7204:(z,m,c)=>{c.r(m),c.d(m,{ArchitectureWizardComponent:()=>w});var h=c(4664),t=c(5879),u=c(529),p=c(9167),C=c(2553),f=c(1574),v=c(957),d=c(6814),_=c(6223),T=c(354),A=c(7254);const g=function(i,a){return{control:i,id:a}};function O(i,a){if(1&i&&(t.ynx(0),t.GkF(1,18),t.BQk()),2&i){const n=a.$implicit,o=a.index;t.oxw();const e=t.MAs(11);t.xp6(1),t.Q6J("ngTemplateOutletContext",t.WLB(2,g,n,o))("ngTemplateOutlet",e)}}function M(i,a){1&i&&t._UZ(0,"span",19)}function b(i,a){if(1&i&&(t.ynx(0),t.GkF(1,18),t.BQk()),2&i){const n=a.$implicit,o=a.index,e=t.oxw(2).id;t.oxw();const r=t.MAs(11);t.xp6(1),t.Q6J("ngTemplateOutletContext",t.WLB(2,g,n,e+"_"+o))("ngTemplateOutlet",r)}}function x(i,a){if(1&i&&(t.O4$(),t.kcU(),t.ynx(0),t.TgZ(1,"div",27),t.YNc(2,b,2,5,"ng-container",4),t.qZA(),t.BQk()),2&i){const n=t.oxw().control;t.xp6(2),t.Q6J("ngForOf",n.children)}}const E=function(i){return{show:i}};function Z(i,a){if(1&i){const n=t.EpF();t.TgZ(0,"div",20)(1,"div",21),t.NdJ("mouseenter",function(){const e=t.CHM(n),r=e.control,s=e.id,l=t.oxw();return t.KtG(l.onMouseEnter(r,s))})("mouseleave",function(){t.CHM(n);const e=t.oxw();return t.KtG(e.onMouseLeave())}),t.TgZ(2,"input",22),t.NdJ("change",function(e){const s=t.CHM(n).control,l=t.oxw();return t.KtG(l.onOptionChange(e,s))})("ngModelChange",function(e){const s=t.CHM(n).control;return t.KtG(s.checked=e)}),t.qZA(),t.TgZ(3,"label",23),t._uU(4),t.qZA(),t.O4$(),t.TgZ(5,"svg",24),t.NdJ("click",function(){const r=t.CHM(n).control,s=t.oxw();return t.KtG(s.showCommands(r))}),t._UZ(6,"path",25),t.qZA()(),t.YNc(7,x,3,1,"ng-container",26),t.qZA()}if(2&i){const n=a.control,o=a.id,e=t.oxw();t.xp6(2),t.Q6J("ngModel",n.checked)("id",o),t.xp6(1),t.Q6J("for",o),t.xp6(1),t.Oqu(n.text),t.xp6(1),t.Q6J("ngClass",t.VKq(6,E,o===e.currentOption)),t.xp6(2),t.Q6J("ngIf",n.children&&n.children.length&&n.checked)}}function k(i,a){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const n=a.$implicit;t.xp6(1),t.hij(" ",n," ")}}let w=(()=>{class i{constructor(n,o,e,r,s){this.templateService=n,this.commandService=o,this.logService=e,this.environmentService=r,this.infoService=s,this.options=[],this.diagram={cellSize:20,rows:30,columns:36,grid:!1,icons:[],links:[]},this.submitting=!1,this.log="",this.showLog=!1,this.showError=!1,this.currentOption="",this.showCommandsModal=!1,this.selectedCommands=[]}ngOnInit(){const n=(this.data?.id||"").match(/^(aws|azure|gcp)_([^_]+)_wizard$/);console.log(n),n&&n.length&&this.templateService.getDiagramData(`wizard/${n[2]}`,[]).pipe((0,h.w)(e=>(this.options=e,this.infoService.data=this.data?.info||"",this.templateService.getDiagramData(this.data?.endpoint||"",this.diagram)))).subscribe(e=>{e.icons=e.icons.map(r=>(r.display=!1,delete r.active,r)),e.cellSize=23,this.diagram=e,this.optionChanged()})}optionChanged(){const n=new Set,o=new Set,e=r=>{r.forEach(s=>{s.checked&&(s.ids.forEach(l=>n.add(Number(l))),(s.actions||[]).forEach(l=>o.add(l))),s.children?.length&&e(s.children)})};e(this.options),this.diagram.icons.forEach(r=>{r.display=[...n].includes(Number(r.id))}),this.environmentService.highlightedActions$.next([...o])}getIconById(n){return this.diagram.icons.find(o=>Number(o.id)===Number(n))}onOptionChange(n,o){!n.currentTarget.checked&&o.children?.length&&this.disableChildren(o.children),this.optionChanged()}disableChildren(n){n.forEach(o=>{o.checked=!1,o.children?.length&&this.disableChildren(o.children)})}sendPayload(){const n={...this.data?.command.command,wizard:this.options};this.submitting=!0,this.commandService.runCommand(n).pipe((0,h.w)(o=>this.logService.getLog(o.log_file))).subscribe(o=>{this.log=o,this.showLog=!0,this.submitting=!1},()=>{this.submitting=!1,this.showError=!0})}modalClose(){this.showLog=!1,this.showError=!1}showCommands(n){this.showCommandsModal=!0,this.selectedCommands=n.cli}onMouseEnter(n,o){!n.cli||!n.cli.length||(this.currentOption=o)}onMouseLeave(){this.currentOption=""}commandsModalClose(){this.showCommandsModal=!1,this.selectedCommands=[]}static#t=this.\u0275fac=function(o){return new(o||i)(t.Y36(u.E),t.Y36(p.V),t.Y36(C.$),t.Y36(f.L),t.Y36(v.C))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["theia-diagram-options"]],inputs:{data:"data"},decls:43,vars:10,consts:[[1,"card"],[1,"card-body"],[1,"d-flex","justify-content-between"],[1,"overflow-auto","wizard-options","px-1"],[4,"ngFor","ngForOf"],[1,"btn","btn-primary","mt-5",3,"disabled","click"],["class","spinner-border spinner-border-sm",4,"ngIf"],[3,"diagram"],["line",""],["classes","modal-xl modal-dialog-scrollable modal-dialog-centered",3,"visible"],["slot","header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],["slot","body"],["slot","footer"],["type","button",1,"btn","btn-primary",3,"click"],["classes","modal-sm modal-dialog-centered",3,"visible"],["classes","modal modal-dialog-scrollable modal-dialog-centered",3,"visible"],[3,"ngTemplateOutletContext","ngTemplateOutlet"],[1,"spinner-border","spinner-border-sm"],[1,"wizard-option"],[1,"form-check",3,"mouseenter","mouseleave"],["type","checkbox",1,"form-check-input",3,"ngModel","id","change","ngModelChange"],[1,"form-check-label",3,"for"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-terminal-fill","terminal",3,"ngClass","click"],["d","M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm9.5 5.5h-3a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1zm-6.354-.354a.5.5 0 1 0 .708.708l2-2a.5.5 0 0 0 0-.708l-2-2a.5.5 0 1 0-.708.708L4.793 6.5 3.146 8.146z"],[4,"ngIf"],[2,"margin-left","2rem"]],template:function(o,e){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),t.YNc(4,O,2,5,"ng-container",4),t.TgZ(5,"button",5),t.NdJ("click",function(){return e.sendPayload()}),t.YNc(6,M,1,0,"span",6),t._uU(7),t.qZA()(),t.TgZ(8,"div"),t._UZ(9,"theia-diagram",7),t.qZA()()()(),t.YNc(10,Z,8,8,"ng-template",null,8,t.W1O),t.TgZ(12,"theia-modal",9),t.ynx(13,10),t.TgZ(14,"h5",11),t._uU(15,"Log"),t.qZA(),t.TgZ(16,"button",12),t.NdJ("click",function(){return e.modalClose()}),t.qZA(),t.BQk(),t.ynx(17,13),t.TgZ(18,"pre"),t._uU(19),t.qZA(),t.BQk(),t.ynx(20,14),t.TgZ(21,"button",15),t.NdJ("click",function(){return e.modalClose()}),t._uU(22,"Ok"),t.qZA(),t.BQk(),t.qZA(),t.TgZ(23,"theia-modal",16),t.ynx(24,10),t.TgZ(25,"h5",11),t._uU(26,"Error"),t.qZA(),t.TgZ(27,"button",12),t.NdJ("click",function(){return e.modalClose()}),t.qZA(),t.BQk(),t.ynx(28,13),t._uU(29," An error occurred please try again later "),t.BQk(),t.ynx(30,14),t.TgZ(31,"button",15),t.NdJ("click",function(){return e.modalClose()}),t._uU(32,"Ok"),t.qZA(),t.BQk(),t.qZA(),t.TgZ(33,"theia-modal",17),t.ynx(34,10),t.TgZ(35,"h5",11),t._uU(36,"Commands"),t.qZA(),t.TgZ(37,"button",12),t.NdJ("click",function(){return e.commandsModalClose()}),t.qZA(),t.BQk(),t.ynx(38,13),t.YNc(39,k,2,1,"div",4),t.BQk(),t.ynx(40,14),t.TgZ(41,"button",15),t.NdJ("click",function(){return e.commandsModalClose()}),t._uU(42,"Ok"),t.qZA(),t.BQk(),t.qZA()),2&o&&(t.xp6(4),t.Q6J("ngForOf",e.options),t.xp6(1),t.Q6J("disabled",e.submitting),t.xp6(1),t.Q6J("ngIf",e.submitting),t.xp6(1),t.hij(" ",null==e.data||null==e.data.command?null:e.data.command.label," "),t.xp6(2),t.Q6J("diagram",e.diagram),t.xp6(3),t.Q6J("visible",e.showLog),t.xp6(7),t.hij("      ",e.log,"\n    "),t.xp6(4),t.Q6J("visible",e.showError),t.xp6(10),t.Q6J("visible",e.showCommandsModal),t.xp6(6),t.Q6J("ngForOf",e.selectedCommands))},dependencies:[d.mk,d.sg,d.O5,d.tP,_.Wl,_.JJ,_.On,T.ModalComponent,A.DiagramComponent],styles:[".wizard-options[_ngcontent-%COMP%]{height:calc(100vh - 13.5rem)}.wizard-options[_ngcontent-%COMP%]   .wizard-option[_ngcontent-%COMP%]{position:relative}.wizard-options[_ngcontent-%COMP%]   .wizard-option[_ngcontent-%COMP%]   .terminal[_ngcontent-%COMP%]{position:absolute;right:0;top:50%;margin-top:-8px;width:16px;height:16px;display:none;cursor:pointer}.wizard-options[_ngcontent-%COMP%]   .wizard-option[_ngcontent-%COMP%]   .show[_ngcontent-%COMP%]{display:block}"]})}return i})()}}]);